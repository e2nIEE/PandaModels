<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Run Optimal Transmission Switching · PandaModels</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://e2nIEE.github.io/PandaModels.jl/stable/ots/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PandaModels</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../quickguide/">Getting Started</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../pptutorial/">Optimazion Problems</a></li></ul></li><li><span class="tocitem">Developer</span><ul><li><a class="tocitem" href="../develop/">Develop Mode</a></li><li><a class="tocitem" href="../test/">Add Test</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Run Optimal Transmission Switching</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Run Optimal Transmission Switching</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/e2nIEE/PandaModels.jl/blob/master/docs/src/ots.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Run-Optimal-Transmission-Switching"><a class="docs-heading-anchor" href="#Run-Optimal-Transmission-Switching">Run Optimal Transmission Switching</a><a id="Run-Optimal-Transmission-Switching-1"></a><a class="docs-heading-anchor-permalink" href="#Run-Optimal-Transmission-Switching" title="Permalink"></a></h1><p>This tutorial describes how to run the <a href="https://lanl-ansi.github.io/PowerModels.jl/stable/specifications/#Optimal-Transmission-Switching-(OTS)">OTS</a> feature of PowerModels.jl together with pandapower.</p><p>The OTS allows to optimize the &quot;switching state&quot; of a (meshed) grid by taking lines out of service. This not exactly the same as optimizing the switching state provided by pandapower. In the OTS case <strong>every in service branch element</strong> in the grid is taken into account in the optimization. This includes all lines and transformers. The optimization then chooses some lines/transformers to be taken out of service in order to minimize fuel cost, see available <a href="https://lanl-ansi.github.io/PowerModels.jl/stable/objective/">objectives</a> options.</p><p>To summerize this means:</p><ul><li>the switching state of the pandapower switches are <strong>not</strong> changed</li><li>all lines / transformer in service states are variables of the optimization</li><li>output of the optimization is a changed &quot;in<em>service&quot; state in the res</em>line / res_trafo... tables.   </li></ul><h3 id="Choose-Proper-Solver"><a class="docs-heading-anchor" href="#Choose-Proper-Solver">Choose Proper Solver</a><a id="Choose-Proper-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Choose-Proper-Solver" title="Permalink"></a></h3><p>The OTS problem is a mixed-integer non-linear problem, which is especially not easy to solve. To be able to solve these kind of problems, you need a suitable solver. Either you use commercial ones (such as Knitro) or the open-source <a href="https://github.com/lanl-ansi/Juniper.jl">Juniper</a> solver which is partly developed by Carleton Coffrin from PowerModels itself. Additionally <a href="https://github.com/JuliaOpt/Cbc.jl">CBC</a> is needed.</p><p>Note that Juniper is a heuristic based solver. Another non-heuristic option would be to use <a href="https://github.com/lanl-ansi/Alpine.jl">Alpine</a></p><h3 id="Prepare-the-Input-Data"><a class="docs-heading-anchor" href="#Prepare-the-Input-Data">Prepare the Input Data</a><a id="Prepare-the-Input-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Prepare-the-Input-Data" title="Permalink"></a></h3><p>To put it simple, the goal of the optimization is to find a changed in_service state for the branch elements (lines, transformers). Note that the OPF calculation also takes into account the voltage and line loading limits.   </p><p>In order to start the optimization, we follow two steps:</p><ol><li>Load the pandapower, or SimBench, grid data</li><li>Start the optimization</li></ol><h4 id="Run-OTS"><a class="docs-heading-anchor" href="#Run-OTS">Run OTS</a><a id="Run-OTS-1"></a><a class="docs-heading-anchor-permalink" href="#Run-OTS" title="Permalink"></a></h4><p>In this example we use the tset case grid from pandapower.networks:</p><pre><code class="language-python hljs">import pandapower.networks as nw
import pandapower as pp

# here we use the simple case5 grid
net = nw.case5()
line_status = net[&quot;line&quot;].loc[:, &quot;in_service&quot;].values
print(&quot;Line status prior to optimization is:&quot;)
print(line_status.astype(bool))

# runs the powermodels.jl switch optimization
pp.runpm_ots(net)
# note that the result is taken from the res_line instead of the line table. The input DataFrame is not changed
line_status = net[&quot;res_line&quot;].loc[:, &quot;in_service&quot;].values
print(&quot;Line status after the optimization is:&quot;)
print(line_status.astype(bool))

</code></pre><h4 id="What-to-do-with-the-result"><a class="docs-heading-anchor" href="#What-to-do-with-the-result">What to do with the result</a><a id="What-to-do-with-the-result-1"></a><a class="docs-heading-anchor-permalink" href="#What-to-do-with-the-result" title="Permalink"></a></h4><p>The optimized line / trafo status can be found in the result DataFrames, e.g. net[&quot;res_line&quot;]. The result ist <strong>not</strong> automatically written to the inputs (&quot;line&quot; DataFrame). To do this you can use:</p><pre><code class="language-python hljs">import pandapower as pp    

# Change the input data
net[&quot;line&quot;].loc[:, &quot;in_service&quot;] = net[&quot;res_line&quot;].loc[:, &quot;in_service&quot;].values
net[&quot;trafo&quot;].loc[:, &quot;in_service&quot;] = net[&quot;res_trafo&quot;].loc[:, &quot;in_service&quot;].values

# optional: run a power flow calculation with the changed in service status
pp.runpp(net)</code></pre><p>If you have line-switches / trafo-switches at these lines/trafos you could also search for the switches connected to these elements (with the topology search) and change the switching state according to the in_service result. This should deliver identical results as changing the in service status of the element. However, this requires to have line switches at <strong>both</strong> ends of the line. If you just open the switch on one of the two sides, the power flow result is slightly different since the line loading of the line without any connected elements is calculated.</p><h3 id="Notes"><a class="docs-heading-anchor" href="#Notes">Notes</a><a id="Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Notes" title="Permalink"></a></h3><ol><li><p>Juniper is based on a heuristic, it does not necessarly find the global optimum. For this use another solver</p></li><li><p>In the PowerModels OPF formulation, generator limits are taken into account. This means you have to specify limits for all gens, ext_grids and controllable sgens / loads.</p></li><li><p>Optionally costs for these can be defined.</p></li><li><p>Also limits for line/trafo loadings and buse voltages are to be defined. The case5 grid has pre-defined limits set. In other cases you might get an error.</p></li></ol><p>Here is a code snippet:</p><pre><code class="language-python hljs">def define_ext_grid_limits(net):
    # define line loading and bus voltage limits
    min_vm_pu = 0.95
    max_vm_pu = 1.05

    net[&quot;bus&quot;].loc[:, &quot;min_vm_pu&quot;] = min_vm_pu
    net[&quot;bus&quot;].loc[:, &quot;max_vm_pu&quot;] = max_vm_pu

    net[&quot;line&quot;].loc[:, &quot;max_loading_percent&quot;] = 100.
    net[&quot;trafo&quot;].loc[:, &quot;max_loading_percent&quot;] = 100.

    # define limits
    net[&quot;ext_grid&quot;].loc[:, &quot;min_p_mw&quot;] = -9999.
    net[&quot;ext_grid&quot;].loc[:, &quot;max_p_mw&quot;] = 9999.
    net[&quot;ext_grid&quot;].loc[:, &quot;min_q_mvar&quot;] = -9999.
    net[&quot;ext_grid&quot;].loc[:, &quot;max_q_mvar&quot;] = 9999.
    # define costs
    for i in net.ext_grid.index:
        pp.create_poly_cost(net, i, &#39;ext_grid&#39;, cp1_eur_per_mw=1)</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Thursday 17 March 2022 15:53">Thursday 17 March 2022</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
